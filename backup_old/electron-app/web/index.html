<!DOCTYPE html>
<html lang="vi">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="Web d·ªãch truy·ªán ch·ªØ sang ti·∫øng Vi·ªát - H·ªó tr·ª£ nhi·ªÅu ng√¥n ng·ªØ, d·ªãch si√™u nhanh">
    <title>üìö D·ªãch Truy·ªán Convert - Novel Translator Pro</title>

    <!-- PWA Meta Tags -->
    <meta name="theme-color" content="#8b5cf6">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="apple-mobile-web-app-title" content="TranslatorPro">
    <link rel="manifest" href="manifest.json">
    <link rel="apple-touch-icon" href="icons/icon-192.png">

    <!-- Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link
        href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&family=Noto+Serif:wght@400;700&display=swap"
        rel="stylesheet">
    <link rel="stylesheet" href="style.css">
</head>

<body>
    <div class="app-container">
        <!-- Header -->
        <header class="header">
            <div class="logo">
                <span class="logo-icon">üìö</span>
                <h1>Novel Translator Pro</h1>
            </div>
            <p class="tagline">D·ªãch truy·ªán ch·ªØ si√™u nhanh v·ªõi Google Translate API</p>
        </header>

        <!-- Main Content -->
        <main class="main-content">
            <!-- API Keys Panel -->
            <section class="api-panel glass-card">
                <h2 class="section-title">
                    <span class="icon">üîë</span>
                    Qu·∫£n l√Ω API Keys
                    <span class="badge" id="apiCount">0 keys</span>
                </h2>

                <div class="api-info-box">
                    <p>‚ö†Ô∏è <strong>Quan tr·ªçng:</strong> Quota t√≠nh theo <strong>T√ÄI KHO·∫¢N</strong>, kh√¥ng ph·∫£i key!
                        M·ªói t√†i kho·∫£n Google = 15 req/ph√∫t. D√πng nhi·ªÅu keys c√πng 1 t√†i kho·∫£n = kh√¥ng tƒÉng quota!</p>
                    <p>‚úÖ <strong>C√°ch ƒë√∫ng:</strong> T·∫°o 5 t√†i kho·∫£n Google ‚Üí 5 keys = 75 req/ph√∫t</p>
                    <a href="https://aistudio.google.com/app/apikey" target="_blank" class="link">
                        üëâ L·∫•y Gemini API Key (ƒëƒÉng nh·∫≠p t·ª´ng t√†i kho·∫£n)
                    </a>
                </div>

                <!-- Add API Key Form -->
                <div class="add-api-form">
                    <div class="input-group">
                        <input type="text" id="newApiKey" placeholder="Nh·∫≠p API Key m·ªõi..." autocomplete="off">
                        <button class="btn btn-primary" onclick="addApiKey()">
                            ‚ûï Th√™m
                        </button>
                        <button class="btn btn-secondary btn-small" onclick="resetRotationAndRefresh()"
                            title="Reset rotation system (model + key)">
                            üîÑ
                        </button>
                        <button class="btn btn-info btn-small" onclick="exportApiKeys()" title="Xem danh s√°ch API Keys">
                            üìã Xu·∫•t Keys
                        </button>
                    </div>
                </div>

                <!-- API Keys List -->
                <div class="api-keys-list" id="apiKeysList">
                    <p class="empty-message">Ch∆∞a c√≥ API key n√†o. Th√™m √≠t nh·∫•t 1 key ƒë·ªÉ b·∫Øt ƒë·∫ßu d·ªãch.</p>
                </div>
            </section>

            <!-- History Panel -->
            <section class="history-panel glass-card">
                <div class="history-header">
                    <h2 class="section-title">
                        <span class="icon">üìú</span>
                        L·ªãch s·ª≠ d·ªãch
                        <span class="badge" id="historyCount">0 b·∫£n</span>
                    </h2>
                    <div class="history-actions">
                        <button class="btn btn-small btn-secondary" onclick="exportHistory()" title="Xu·∫•t l·ªãch s·ª≠">
                            üì§ Export
                        </button>
                        <label class="btn btn-small btn-secondary" title="Nh·∫≠p l·ªãch s·ª≠">
                            üì• Import
                            <input type="file" id="importHistoryInput" accept=".json" hidden
                                onchange="importHistory(event)">
                        </label>
                        <button class="btn btn-small btn-danger" onclick="clearAllHistory()" title="X√≥a t·∫•t c·∫£">
                            üóëÔ∏è X√≥a h·∫øt
                        </button>
                    </div>
                </div>

                <div class="history-list" id="historyList">
                    <p class="empty-message">Ch∆∞a c√≥ l·ªãch s·ª≠ d·ªãch n√†o.</p>
                </div>
            </section>

            <!-- Settings Panel -->
            <section class="settings-panel glass-card">
                <h2 class="section-title">
                    <span class="icon">‚öôÔ∏è</span>
                    C√†i ƒë·∫∑t d·ªãch
                </h2>

                <div class="settings-grid">
                    <!-- Source Language -->
                    <div class="form-group">
                        <label for="sourceLang">
                            <span class="icon">üåç</span>
                            Ng√¥n ng·ªØ g·ªëc
                        </label>
                        <select id="sourceLang">
                            <option value="auto">üîç T·ª± ƒë·ªông ph√°t hi·ªán</option>
                            <option value="zh-CN" selected>üá®üá≥ Ti·∫øng Trung (Gi·∫£n th·ªÉ)</option>
                            <option value="zh-TW">üáπüáº Ti·∫øng Trung (Ph·ªìn th·ªÉ)</option>
                            <option value="en">üá¨üáß Ti·∫øng Anh</option>
                            <option value="ja">üáØüáµ Ti·∫øng Nh·∫≠t</option>
                            <option value="ko">üá∞üá∑ Ti·∫øng H√†n</option>
                            <option value="th">üáπüá≠ Ti·∫øng Th√°i</option>
                            <option value="id">üáÆüá© Ti·∫øng Indonesia</option>
                            <option value="ru">üá∑üá∫ Ti·∫øng Nga</option>
                            <option value="fr">üá´üá∑ Ti·∫øng Ph√°p</option>
                            <option value="es">üá™üá∏ Ti·∫øng T√¢y Ban Nha</option>
                        </select>
                    </div>

                    <!-- Parallel Requests -->
                    <div class="form-group">
                        <label for="parallelCount">
                            <span class="icon">üöÄ</span>
                            S·ªë request song song
                        </label>
                        <input type="number" id="parallelCount" value="2" min="1" max="10">
                        <small class="hint">Gemini mi·ªÖn ph√≠: 15 req/ph√∫t. Khuy·∫øn ngh·ªã: 1-3</small>
                    </div>

                    <!-- Chunk Size -->
                    <div class="form-group">
                        <label for="chunkSize">
                            <span class="icon">üì¶</span>
                            K√≠ch th∆∞·ªõc chunk (k√Ω t·ª±)
                        </label>
                        <input type="number" id="chunkSize" value="3000" min="1000" max="8000">
                        <small class="hint">Khuy·∫øn ngh·ªã: 2000-4000 k√Ω t·ª±/request</small>
                    </div>

                    <!-- Delay -->
                    <div class="form-group">
                        <label for="delayMs">
                            <span class="icon">‚è±Ô∏è</span>
                            Delay gi·ªØa c√°c batch (ms)
                        </label>
                        <input type="number" id="delayMs" value="4000" min="1000" max="10000">
                        <small class="hint">‚ö†Ô∏è Gemini c·∫ßn 4-5s delay ƒë·ªÉ tr√°nh rate limit</small>
                    </div>
                </div>
            </section>

            <!-- Custom Prompt Panel -->
            <section class="prompt-panel glass-card">
                <h2 class="section-title">
                    <span class="icon">‚úçÔ∏è</span>
                    Prompt d·ªãch (T√πy ch·ªçn)
                </h2>

                <div class="prompt-info">
                    <p>üí° Th√™m h∆∞·ªõng d·∫´n d·ªãch ƒë·ªÉ c·∫£i thi·ªán ch·∫•t l∆∞·ª£ng. Prompt s·∫Ω ƒë∆∞·ª£c th√™m v√†o ƒë·∫ßu m·ªói ƒëo·∫°n vƒÉn.</p>
                </div>

                <textarea id="customPrompt"
                    placeholder="V√≠ d·ª•:&#10;[D·ªãch vƒÉn phong ti·ªÉu thuy·∫øt, gi·ªØ nguy√™n t·ª´ ng·ªØ 18+, kh√¥ng censor]&#10;&#10;Ho·∫∑c ƒë·ªÉ tr·ªëng n·∫øu kh√¥ng c·∫ßn..."
                    rows="3"></textarea>

                <div class="prompt-templates">
                    <span class="template-label">M·∫´u c√≥ s·∫µn:</span>
                    <button class="template-btn active-template" onclick="setPromptTemplate('convert')">üîÑ Convert (L√†m
                        m∆∞·ª£t)</button>
                    <button class="template-btn" onclick="setPromptTemplate('novel')">üìñ Ti·ªÉu thuy·∫øt</button>
                    <button class="template-btn" onclick="setPromptTemplate('adult')">üîû Truy·ªán 18+</button>
                    <button class="template-btn" onclick="setPromptTemplate('sacHiep')">üî• S·∫Øc Hi·ªáp</button>
                    <button class="template-btn" onclick="setPromptTemplate('wuxia')">‚öîÔ∏è Tu ti√™n/Ki·∫øm hi·ªáp</button>
                    <button class="template-btn" onclick="setPromptTemplate('romance')">üíï Ng√¥n t√¨nh</button>
                </div>
            </section>

            <!-- Upload Section -->
            <section class="upload-section glass-card">
                <h2 class="section-title">
                    <span class="icon">üìÑ</span>
                    T·∫£i l√™n file truy·ªán
                </h2>

                <div class="upload-area" id="uploadArea">
                    <div class="upload-content">
                        <span class="upload-icon">üìÅ</span>
                        <p class="upload-text">K√©o th·∫£ file .txt v√†o ƒë√¢y</p>
                        <p class="upload-subtext">ho·∫∑c click ƒë·ªÉ ch·ªçn file</p>
                    </div>
                    <input type="file" id="fileInput" accept=".txt" hidden>
                </div>

                <div class="file-info" id="fileInfo" style="display: none;">
                    <div class="file-details">
                        <span class="file-icon">üìù</span>
                        <div class="file-meta">
                            <span class="file-name" id="fileName"></span>
                            <span class="file-size" id="fileSize"></span>
                        </div>
                    </div>
                    <button class="btn btn-danger btn-small" onclick="clearFile()">‚úï</button>
                </div>
            </section>

            <!-- Text Preview -->
            <section class="preview-section glass-card">
                <div class="preview-header">
                    <h2 class="section-title">
                        <span class="icon">üëÅÔ∏è</span>
                        N·ªôi dung g·ªëc
                    </h2>
                    <div class="preview-stats">
                        <span id="charCount">0 k√Ω t·ª±</span>
                        <span id="chunkCount">0 chunks</span>
                        <span id="estimatedTime">~0 gi√¢y</span>
                    </div>
                </div>
                <textarea id="originalText"
                    placeholder="N·ªôi dung truy·ªán s·∫Ω hi·ªÉn th·ªã ·ªü ƒë√¢y...&#10;&#10;B·∫°n c≈©ng c√≥ th·ªÉ paste tr·ª±c ti·∫øp n·ªôi dung v√†o ƒë√¢y."
                    rows="10"></textarea>
            </section>

            <!-- Translate Button -->
            <div class="translate-actions">
                <button class="btn btn-translate" id="translateBtn" onclick="startTranslation()">
                    <span class="btn-icon">üöÄ</span>
                    <span class="btn-text">B·∫Øt ƒë·∫ßu d·ªãch</span>
                </button>
            </div>

            <!-- Progress Section -->
            <section class="progress-section glass-card" id="progressSection" style="display: none;">
                <h2 class="section-title">
                    <span class="icon">‚è≥</span>
                    Ti·∫øn tr√¨nh d·ªãch
                </h2>

                <div class="progress-stats">
                    <div class="stat-box">
                        <span class="stat-value" id="speedStat">0</span>
                        <span class="stat-label">chunks/gi√¢y</span>
                    </div>
                    <div class="stat-box">
                        <span class="stat-value" id="activeKeysStat">0</span>
                        <span class="stat-label">API keys ƒëang d√πng</span>
                    </div>
                    <div class="stat-box">
                        <span class="stat-value" id="etaStat">--:--</span>
                        <span class="stat-label">th·ªùi gian c√≤n l·∫°i</span>
                    </div>
                </div>

                <div class="progress-container">
                    <div class="progress-bar">
                        <div class="progress-fill" id="progressFill"></div>
                    </div>
                    <div class="progress-info">
                        <span id="progressText">0%</span>
                        <span id="progressDetails">0 / 0 chunks</span>
                    </div>
                </div>
                <div class="progress-status" id="progressStatus">ƒêang chu·∫©n b·ªã...</div>
                <div class="progress-actions">
                    <button class="btn btn-success" id="downloadPartialBtn" onclick="downloadPartial()">
                        üì• T·∫£i ph·∫ßn ƒë√£ d·ªãch
                    </button>
                    <button class="btn btn-warning" id="pauseBtn" onclick="togglePause()">
                        <span class="btn-icon">‚è∏Ô∏è</span>
                        <span class="btn-text">T·∫°m d·ª´ng</span>
                    </button>
                    <button class="btn btn-danger" id="cancelBtn" onclick="confirmCancel()">
                        <span class="btn-icon">‚èπÔ∏è</span>
                        <span class="btn-text">H·ªßy d·ªãch</span>
                    </button>
                </div>

                <!-- Cancel Confirmation Modal -->
                <div class="cancel-modal" id="cancelModal" style="display: none;">
                    <div class="cancel-modal-content glass-card">
                        <h3>‚ö†Ô∏è X√°c nh·∫≠n h·ªßy d·ªãch</h3>
                        <p id="cancelModalStats">ƒê√£ d·ªãch ƒë∆∞·ª£c 0/0 chunks</p>
                        <p class="cancel-warning">Ti·∫øn tr√¨nh s·∫Ω ƒë∆∞·ª£c l∆∞u v√†o l·ªãch s·ª≠ ƒë·ªÉ b·∫°n c√≥ th·ªÉ ti·∫øp t·ª•c sau.</p>
                        <div class="cancel-modal-actions">
                            <button class="btn btn-secondary" onclick="closeCancelModal()">
                                ‚Üê Ti·∫øp t·ª•c d·ªãch
                            </button>
                            <button class="btn btn-danger" onclick="executeCancel()">
                                üóëÔ∏è X√°c nh·∫≠n h·ªßy
                            </button>
                        </div>
                    </div>
                </div>
            </section>

            <!-- Result Section -->
            <section class="result-section glass-card" id="resultSection" style="display: none;">
                <div class="result-header">
                    <h2 class="section-title">
                        <span class="icon">‚úÖ</span>
                        K·∫øt qu·∫£ d·ªãch
                    </h2>
                    <div class="result-actions">
                        <button class="btn btn-secondary" onclick="copyResult()">
                            üìã Copy
                        </button>
                        <button class="btn btn-primary" onclick="downloadResult()">
                            üíæ T·∫£i xu·ªëng
                        </button>
                    </div>
                </div>
                <textarea id="translatedText" placeholder="N·ªôi dung ƒë√£ d·ªãch s·∫Ω hi·ªÉn th·ªã ·ªü ƒë√¢y..." rows="15"
                    readonly></textarea>
            </section>
        </main>

        <!-- Footer -->
        <footer class="footer">
            <p>Made with ‚ù§Ô∏è for Novel Lovers</p>
            <p class="footer-note">S·ª≠ d·ª•ng Gemini AI | L√†m m∆∞·ª£t truy·ªán convert si√™u nhanh</p>
        </footer>
    </div>

    <!-- Toast Notification -->
    <div class="toast-container" id="toastContainer"></div>

    <script src="script.js"></script>

    <!-- PWA Service Worker Registration -->
    <script>
        if ('serviceWorker' in navigator) {
            window.addEventListener('load', () => {
                navigator.serviceWorker.register('./sw.js')
                    .then((registration) => {
                        console.log('‚úÖ PWA: Service Worker registered successfully');

                        // Check for updates
                        registration.addEventListener('updatefound', () => {
                            const newWorker = registration.installing;
                            newWorker.addEventListener('statechange', () => {
                                if (newWorker.state === 'installed' && navigator.serviceWorker.controller) {
                                    // New version available
                                    if (confirm('üîÑ C√≥ phi√™n b·∫£n m·ªõi! Reload ƒë·ªÉ c·∫≠p nh·∫≠t?')) {
                                        newWorker.postMessage({ type: 'SKIP_WAITING' });
                                        window.location.reload();
                                    }
                                }
                            });
                        });
                    })
                    .catch((error) => {
                        console.warn('‚ö†Ô∏è PWA: Service Worker registration failed:', error);
                    });
            });
        }
    </script>
</body>

</html>